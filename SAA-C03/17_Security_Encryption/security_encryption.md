# AWS Security & Encryption
- 암호화
  - 전송 중 암호화 (SSL)
    - 데이터는 전송 전에 암호화되고 수신 후에 복호화됩니다.
    - SSL 인증서는 암호화에 도움을 줍니다 (HTTPS).
    - 전송 중 암호화는 MITM(중간자 공격)이 발생하지 않도록 보장합니다.
  - 정적 데이터 암호화 (서버 측)
    - 데이터가 서버에 도착한 후에 암호화됩니다.
    - 데이터가 전송되기 전에 복호화됩니다.
    - 일반적으로 데이터 키를 사용하여 데이터는 암호화된 상태로 저장됩니다.
    - 암호화/복호화 키는 어딘가에서 관리되어야 하며 서버는 이에 액세스할 수 있어야 합니다.
  - 클라이언트 측 암호화
    - 데이터는 클라이언트에 의해 암호화되고 서버에서는 결코 복호화되지 않습니다.
    - 데이터는 수신 클라이언트에 의해 복호화됩니다.
    - 서버는 데이터를 복호화할 수 없어야 합니다.
    - Envelope Encryption을 활용할 수 있습니다.
- AWS KMS (Key Management Service)
  - AWS에서 "암호화"라는 용어를 들으면 대부분 KMS(Key Management Service)를 의미합니다.
  - AWS가 우리를 대신해서 암호화 키를 관리합니다.
  - 인가를 위해 IAM과 완전히 통합되어 있습니다.
  - 데이터에 대한 액세스를 쉽게 제어할 수 있는 방법입니다.
  - CloudTrail을 사용하여 KMS 키 사용을 감사할 수 있습니다.
  - 대부분의 AWS 서비스와 원활하게 통합됩니다(EBS, S3, RDS, SSM 등).
  - 비밀 정보를 암호화하지 않고 일반 텍스트로 저장하면 안됩니다. 특히 코드 내에 저장하면 안됩니다!
    - KMS 키 암호화는 API 호출(SDK, CLI)을 통해 사용할 수도 있습니다.
    - 암호화된 비밀 정보는 코드나 환경 변수에 저장할 수 있습니다.
  - KMS 키의 유형
    - KMS 키는 이전에는 KMS 고객 마스터 키라는 이름을 가지고 있었습니다.
    - 대칭 키 (AES-256 키)
      - 암호화와 복호화에 사용되는 단일 대칭 키입니다.
      - KMS와 통합된 AWS 서비스는 대칭 CMK를 사용합니다.
      - KMS 키에 대한 액세스는 암호화되어 있으므로 암호 해독을 위해 KMS API를 호출해야 합니다.
    - 비대칭 키 (RSA 및 ECC 키 쌍)
      - 공개 키(암호화)와 개인 키(복호화) 쌍
      - 암호화/복호화 또는 서명/검증 작업에 사용됩니다.
      - 공개 키는 다운로드할 수 있지만, 개인 키에는 암호 해독할 수 없습니다.
      - 사용 사례: KMS API를 호출할 수 없는 사용자에 의해 AWS 외부에서의 암호화
  - KMS 키의 종류
    - AWS 소유 키 (무료): SSE-S3, SSE-SQS, SSE-DDB (기본 키)
    - AWS 관리 키: 무료 (aws/service-name, 예: aws/rds 또는 aws/ebs)
    - KMS에서 생성된 고객 관리 키: 월별 $1
    - 가져온 고객 관리 키 (대칭 키여야 함): 월별 $1
    - KMS에 대한 API 호출 비용 지불 ($0.03 / 10,000 호출)
  - 자동 키 로테이션
    - AWS 관리 KMS 키: 1년마다 자동으로 로테이션
    - 고객 관리 KMS 키: (활성화 필요) 1년마다 자동으로 로테이션
    - 가져온 KMS 키: 별칭을 사용하여 수동 로테이션만 가능
  - KMS 키 정책
    - KMS 키에 대한 액세스를 제어하는데 사용되며, S3 버킷 정책과 "유사"합니다.
    - 차이점: KMS 키 정책 없이는 액세스를 제어할 수 없습니다.
    - 기본 KMS 키 정책
      - 특정 KMS 키 정책을 제공하지 않으면 생성됨
    - 루트 사용자(전체 AWS 계정)에 대한 키의 완전한 액세스 권한 부여
      - 사용자 및 역할로 KMS 키에 액세스할 수 있는 권한 정의
      - 키를 관리할 수 있는 사용자를 정의
      - KMS 키의 교차 계정 액세스에 유용
- KMS Multi-Region Keys
  - 다른 AWS 리전에서 상호 교환 가능한 동일한 KMS 키
  - 다중 리전 키는 동일한 키 ID, 키 재료, 자동 로테이션을 가지고 있습니다.
  - 한 리전에서 암호화하고 다른 리전에서 복호화할 수 있습니다.
  - 다시 암호화하거나 리전 간 API 호출을 수행할 필요가 없습니다.
  - KMS 다중 리전은 전역적이지 않습니다(기본 + 복제품).
  - 각 다중 리전 키는 독립적으로 관리됩니다.
  - 사용 사례: 전역 클라이언트 측 암호화, 글로벌 DynamoDB, 글로벌 Aurora에서의 암호화.
- S3 복제 암호화 고려 사항
  - 암호화되지 않은 개체 및 SSE-S3로 암호화된 개체는 기본적으로 복제됩니다.
  - SSE-C(고객 제공 키로 암호화된 개체)는 절대로 복제되지 않습니다.
  - SSE-KMS로 암호화된 개체의 경우 옵션을 활성화해야 합니다.
    - 대상 버킷 내에서 개체를 암호화하기 위해 어떤 KMS 키를 사용할지 지정합니다.
    - 대상 키를 위해 KMS 키 정책을 조정합니다.
    - 소스 KMS 키에 대한 kms:Decrypt 및 대상 KMS 키에 대한 kms:Encrypt를 가진 IAM 역할을 사용합니다.
    - KMS 쓰로틀링 오류가 발생할 수 있으며, 이 경우 서비스 할당량 증가를 요청할 수 있습니다.
  - 다중 리전 AWS KMS 키를 사용할 수 있지만, 현재 Amazon S3에서는 독립적인 키로 처리됩니다(객체는 여전히 복호화되고 암호화됩니다).
- KMS를 통해 암호화된 AMI 공유 과정
  - 소스 계정의 AMI는 소스 계정의 KMS 키로 암호화됩니다.
  - 대상 AWS 계정에 해당하는 시작 권한을 추가하기 위해 이미지 속성을 수정해야 합니다.
  - AMI가 참조하는 스냅샷을 암호화하는 데 사용된 KMS 키를 대상 계정과 공유해야 합니다. 이를 위해 KMS 키를 대상 계정 또는 IAM 역할과 공유해야 합니다.
  - 대상 계정의 IAM 역할/사용자는 DescribeKey, ReEncrypt, CreateGrant, Decrypt 등의 권한을 가져야 합니다.
  - AMI에서 EC2 인스턴스를 시작할 때, 대상 계정은 볼륨을 다시 암호화하기 위해 자체 계정에서 새로운 KMS 키를 지정할 수 있습니다. 이는 선택 사항입니다.
- SSM Parameter Store
  - 설정과 비밀 정보를 위한 안전한 저장소
  - KMS를 사용한 선택적인 원활한 암호화
  - 서버리스, 확장 가능하며 내구성이 있는 쉬운 SDK
  - 설정과 비밀 정보의 버전 추적
  - IAM을 통한 보안
  - Amazon EventBridge를 통한 알림
  - CloudFormation과의 통합
  - 파라미터 정책 (고급 파라미터)
    - TTL (유효 기간)을 파라미터에 할당하여 패스워드와 같은 민감한 데이터의 업데이트 또는 삭제를 강제할 수 있습니다.
    - 한 번에 여러 정책을 할당할 수 있습니다.
- AWS Secrets Manager
  - 새로운 서비스로, 비밀 정보를 저장하기 위해 만들어진 서비스입니다.
  - 주기적으로 비밀 정보를 강제로 변경하는 기능을 제공합니다.
  - 비밀 정보를 변경할 때 자동으로 생성하는 기능을 제공합니다. (Lambda를 사용함)
  - Amazon RDS (MySQL, PostgreSQL, Aurora)와의 통합 기능을 제공합니다.
  - 비밀 정보는 KMS를 사용하여 암호화됩니다.
  - 주로 RDS 통합을 위해 사용됩니다.
  - 다중 리전 Secrets
    - 여러 AWS 리전 간에 Secrets를 복제합니다.
    - Secrets Manager는 읽기 복제본을 기본 Secret과 동기화합니다.
    - 읽기 복제본 Secret을 독립된 Secret으로 승격시킬 수 있습니다.
    - 사용 사례: 다중 리전 애플리케이션, 재해 복구 전략, 다중 리전 데이터베이스 등