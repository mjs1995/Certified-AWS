- EC2 예산 설정
  - root 계정 > 계정 설정 > 결제 정보에 대한 IAM 사용자 및 역할 액세스 > IAM 액세스 활성화 
  - <img width="955" alt="image" src="https://github.com/mjs1995/muse-data-engineer/assets/47103479/183bb65c-7457-4c44-bb49-2f62e45b1c79">
  - iam 사용자 계정 > Budgets > 예산 생성 
  - ![image](https://github.com/mjs1995/muse-data-engineer/assets/47103479/0c93a42a-b630-40a8-8703-82f2b090ee03)
- EC2 기초 
  - EC2 = Elastic Compute Cloud = Infrastructure as a Service
  - 주요 구성 요소 
    - Renting virtual machines (EC2)
    - Storing data on virtual drives (EBS)
    - Distributing load across machines (ELB)
    - Scaling the services using an auto-scaling group (ASG)
  - EC2 사용자 데이터
    - EC2 사용자 데이터 스크립트를 사용하여 인스턴스를 부트스트랩할 수 있습니다.
    - 부트스트랩은 인스턴스가 시작될 때 명령을 실행하는 것을 의미합니다.
    - 해당 스크립트는 인스턴스가 처음 시작될 때에만 실행됩니다.
    - EC2 사용자 데이터는 다음과 같은 부트 작업을 자동화하는 데 사용됩니다:
      - 업데이트 설치
      - 소프트웨어 설치
      - 인터넷에서 일반 파일 다운로드
      - 생각할 수 있는 모든 작업
    - EC2 사용자 데이터 스크립트는 root 사용자로 실행됩니다.
  - 인스턴스 타입
    - <img width="1117" alt="image" src="https://github.com/mjs1995/muse-data-engineer/assets/47103479/5f3f6902-8320-4024-bb98-b33a51629fec">
- EC2 생성
  - EC2 > 인스턴스 > 인스턴스 시작 > 인스턴스 생성
  - ![image](https://github.com/mjs1995/muse-data-engineer/assets/47103479/740b4b88-4893-4802-a304-e04ec5f6f427)
  - 키 페어(로그인) > 키 페어 생성
  - ![image](https://github.com/mjs1995/muse-data-engineer/assets/47103479/b209dd22-5472-49e4-aeb4-c879277da58a)
  - 네트워크 설정 > 인터넷에서 HTTP 트래픽 허용 체크 
  - 고급 세부 정보 > 사용자 데이터 > 명령어 입력 (몇 가지 업데이트하고 HTTP 웹 서버를 머신에 설치)
  - ```bash
    #!/bin/bash
    # Use this for your user data (script from top to bottom)
    # install httpd (Linux 2 version)
    yum update -y
    yum install -y httpd
    systemctl start httpd
    systemctl enable httpd
    echo "<h1>Hello World from $(hostname -f)</h1>" > /var/www/html/index.html
    ```
  - ![image](https://github.com/mjs1995/muse-data-engineer/assets/47103479/7920997b-54ae-43f5-a177-af68f40136f4)
  - ![image](https://github.com/mjs1995/muse-data-engineer/assets/47103479/c7103303-4d13-47d5-bfaf-f122c856816e)
- EC2 인스턴스 유형 기본 사항
  - m5.2xlarge
    - m: instance class
    - 5: generation (AWS improves them over time)
    - 2xlarge: size within the instance class
  - EC2 인스턴스 타입 
    - Compute Optimized
      - ![image](https://github.com/mjs1995/muse-data-engineer/assets/47103479/90e023be-fd67-440f-b2bc-29edc71e82a3)
      - 고성능 프로세서가 필요한 계산 집약적인 작업에 적합합니다.
        - 일괄 처리 작업 부하
        - 미디어 변환 작업
        - 고성능 웹 서버
        - 고성능 컴퓨팅 (HPC)
        - 과학 모델링 및 머신 러닝
        - 전용 게임 서버
    - Memory Optimized
      - ![image](https://github.com/mjs1995/muse-data-engineer/assets/47103479/b913fd28-9aa8-4121-b210-6efc36c1c4c5)
      - 대용량 데이터 세트를 메모리에서 처리하는 작업에 빠른 성능을 제공합니다.
      - 사용 사례
        - 고성능 관계형/비관계형 데이터베이스
        - 분산 웹 규모의 캐시 저장소
        - 비즈니스 인텔리전스(BI)에 최적화된 인메모리 데이터베이스
        - 대용량 비구조화 데이터의 실시간 처리를 수행하는 애플리케이션
    - Storage Optimized
      - ![image](https://github.com/mjs1995/muse-data-engineer/assets/47103479/43a8f730-9c0b-49df-9213-027c9a6ee358)
      - 로컬 스토리지에서 대용량 데이터 세트에 대한 고도의 순차적인 읽기 및 쓰기 액세스가 필요한 저장 과제에 적합합니다.
      - 사용 사례
        - 고주파 온라인 트랜잭션 처리(OLTP) 시스템
        - 관계형 및 NoSQL 데이터베이스
        - 인메모리 데이터베이스의 캐시 (예: Redis)
        - 데이터 웨어하우징 애플리케이션
        - 분산 파일 시스템
    - ![image](https://github.com/mjs1995/muse-data-engineer/assets/47103479/4d7552ec-8995-499e-b28f-3ce4e63723dc)
- 보안 그룹
  - 보안 그룹은 EC2 인스턴스에서 "방화벽"으로 작동합니다.
    - 포트에 대한 액세스
    - 허용된 IP 범위 - IPv4 및 IPv6
    - 인바운드 네트워크의 제어 (다른 곳에서 인스턴스로)
    - 아웃바운드 네트워크의 제어 (인스턴스에서 다른 곳으로)
  - <img width="974" alt="image" src="https://github.com/mjs1995/muse-data-engineer/assets/47103479/da5ee7e2-2dfb-4a51-80a6-7ccb36350eb8">
- 클래식 포트
  - 22 = SSH (Secure Shell) - Linux 인스턴스에 로그인하기 위한 포트
  - 21 = FTP (File Transfer Protocol) - 파일 공유에 파일을 업로드하기 위한 포트
  - 22 = SFTP (Secure File Transfer Protocol) - SSH를 사용하여 파일을 업로드하기 위한 포트
  - 80 = HTTP - 보안되지 않은 웹사이트에 접근하기 위한 포트
  - 443 = HTTPS - 보안된 웹사이트에 접근하기 위한 포트
  - 3389 = RDP (Remote Desktop Protocol) - Windows 인스턴스에 로그인하기 위한 포트
- EC2 인스턴스 구매 옵션
  - On-Demand Instances - 짧은 작업 부하, 예측 가능한 가격, 초당 지불
    - 사용한 만큼 지불
    - Linux 또는 Windows - 처음 1분 이후 초당 청구
    - 다른 모든 운영 체제 - 시간당 청구
    - 가장 높은 비용이지만 선결제는 없음
    - 장기 계약 없음
    - 애플리케이션의 동작을 예측할 수 없는 단기 및 중단되지 않는 작업 부하에 권장
  - Reserved (1년 & 3년)
    - Reserved Instances - 긴 작업 부하
    - Convertible Reserved Instances(전환형 예약 인스턴스) - 유연한 인스턴스를 사용하는 긴 작업 부하
      - 온디맨드에 비해 최대 72% 할인
      - 특정 인스턴스 속성 (인스턴스 유형, 리전, 테넌시, 운영 체제)를 예약
      - 예약 기간 - 1년 (+ 할인) 또는 3년 (+++ 할인)
      - 지불 옵션 - 선결제 없음 (+), 일부 선결제 (++), 전액 선결제 (+++)
      - 예약 인스턴스의 범위 - 리전별 또는 가용 영역별 (특정 가용 영역에 용량 예약)
      - 안정된 상태의 애플리케이션에 권장됩니다 (데이터베이스 등)
      - 예약 인스턴스 마켓플레이스에서 구매 및 판매 가능
      - 전환형 예약 인스턴스
        - EC2 인스턴스 유형, 패밀리, 운영 체제, 범위 및 테넌시 변경 가능
        - 최대 66% 할인 가능
  - Savings Plans (1년 및 3년) - 특정 사용량에 대한 약정, 긴 작업 부하
    - 장기 사용에 따른 할인을 받습니다 (최대 72% - 예약 인스턴스와 동일)
    - 특정 유형의 사용에 약정합니다 (예: 1년 또는 3년에 대한 시간당 $10)
    - EC2 절감 요금제를 초과하는 사용은 온디맨드 가격으로 청구됩니다.
    - 특정 인스턴스 패밀리 및 AWS 리전에 고정됩니다 (예: us-east-1에서의 M5)
    - 다음과 같이 유연합니다:
      - 인스턴스 크기 (예: m5.xlarge, m5.2xlarge)
      - 운영 체제 (예: Linux, Windows)
      - 테넌시 (호스트, 전용, 기본)
  - Spot Instances - 짧은 작업 부하, 저렴하게 이용 가능하지만 인스턴스 손실 가능 (신뢰성이 낮음)
    - 온디맨드에 비해 최대 90% 할인 가능
    - 현재 스팟 가격보다 최대 가격이 낮으면 언제든지 인스턴스를 잃을 수 있는 인스턴스
    - AWS에서 가장 비용 효율적인 인스턴스
    - 장애에 강한 작업 부하에 유용
      - 일괄 작업
      - 데이터 분석
      - 이미지 처리
      - 분산 작업 부하
      - 유연한 시작 및 종료 시간을 가진 작업 부하
    - 중요한 작업이나 데이터베이스에는 적합하지 않습니다.
  - Dedicated Hosts(전용호스트) - 전체 물리적 서버를 예약하여 인스턴스 배치를 제어
    - EC2 인스턴스 용량이 완전히 할당된 물리적 서버
    - 규정 준수 요구 사항 충족 및 기존 서버 바인딩 소프트웨어 라이선스 (소켓당, 코어당, 가상머신 소프트웨어 라이선스) 사용 가능
    - 구매 옵션
      - 온디맨드 - 활성화된 전용 호스트에 대해 초당 지불
      - 예약 - 1년 또는 3년 (선결제 없음, 일부 선결제, 전액 선결제)
    - 가장 비싼 옵션
    - 복잡한 라이선스 모델을 갖는 소프트웨어에 유용 (BYOL - Bring Your Own License)
    - 또는 강력한 규정 준수 요구 사항을 가진 회사에 유용
  - Dedicated Instances - 다른 고객과 하드웨어를 공유하지 않음
    - 인스턴스가 전용으로 할당된 하드웨어에서 실행됩니다.
    - 동일한 계정 내의 다른 인스턴스와 하드웨어를 공유할 수 있습니다.
    - 인스턴스 배치에 대한 제어가 없습니다 (정지/시작 후 하드웨어 이동 가능).
  - Capacity Reservations - 특정 가용 영역에서 용량을 예약하여 지속 시간을 선택할 수 있음 
    - 특정 가용 영역에서 온디맨드 인스턴스 용량을 원하는 기간 동안 예약합니다.
    - 필요할 때 언제든지 EC2 용량에 액세스할 수 있습니다.
    - 시간 약정이 없으며 (언제든지 생성/취소 가능), 할인된 청구가 없습니다.
    - 리전 예약 인스턴스 및 절감 요금제와 결합하여 청구 할인 혜택을 받을 수 있습니다.
    - 인스턴스를 실행하든 그렇지 않든 온디맨드 요금이 청구됩니다.
    - 특정 가용 영역에 위치해야 하는 단기간의 중단되지 않는 작업 부하에 적합합니다.
- 구매 옵션 비유
  - 온디맨드: 언제든지 원하는 때에 리조트에 오고 머무를 수 있으며 전가격을 지불합니다.
  - 예약: 앞으로의 계획을 세우고 오래 머무를 경우 좋은 할인 혜택을 받을 수 있습니다.
  - 절약 플랜: 특정 기간 동안 매 시간 일정 금액을 지불하고 어떤 유형의 객실 (예: 킹 사이즈, 스위트, 해변 전망 등)에 머무를 수 있습니다.
  - 스팟 인스턴스: 호텔이 빈 방에 대해 입찰을 받고 가장 높은 입찰자가 방을 유지합니다. 언제든지 퇴실될 수 있습니다.
  - 전용 호스트: 리조트의 전체 건물을 예약합니다.
  - 용량 예약: 특정 기간 동안 방을 예약하고 머물지 않아도 전가격을 지불합니다.
  - m4.large – us-east-1
    - ![image](https://github.com/mjs1995/muse-data-engineer/assets/47103479/b0148300-9181-4dae-a5e0-924242e5c7f2)
- EC2 스팟 인스턴스 요청
  - 온디맨드 가격 대비 최대 90% 할인 가능
  - 최대 스팟 가격을 설정하고 현재 스팟 가격이 최대 가격보다 낮을 때 인스턴스 획득
    - 시간당 스팟 가격은 제공과 용량에 따라 다양함
    - 현재 스팟 가격이 최대 가격을 초과하면 2분의 유예 기간 후 인스턴스 중지 또는 종료 선택 가능
  - 다른 전략: 스팟 블록
    - 특정 시간대 (1~6시간) 동안 스팟 인스턴스 블록하여 중단 없이 사용 가능
    - 특별한 상황에서는 인스턴스가 회수될 수 있음
  - 일괄 작업, 데이터 분석 또는 장애에 강한 워크로드에 사용됨
  - 중요한 작업이나 데이터베이스에는 적합하지 않음
- 스팟 인스턴스를 종료하는 방법
  - 요청의 두 가지 유형
    - 스팟 인스턴스를 위한 일회성 요청
      - 스팟 요청이 사라져도 괜찮은 경우에 사용하는 유형이 되겠습니다
    - 사후 인스턴스를 위한 지속적인 요청
      - 어떤 이유로 인스턴스가 중단되거나 스팟 가격 상승을 이유로 방해를 받은 경우에는 스팟 요청이 다시 전달되어 요청이 검증되고 나면 스팟 인스턴스가 재시작
      - 지속적 요청 모드에서는 스팟 인스턴스가 중단되어도 스팟 요청이 여전히 활성화되어 있기 때문에 스팟 요청이 자동적으로 인스턴스를 재시작해 줌 
  - ![image](https://github.com/mjs1995/muse-data-engineer/assets/47103479/390addf8-421c-44b0-9e47-848f570c1c36)
  - 종료하려는 스팟 인스턴스와 관련된 스팟 요청을 취소해야 합니다. 
  - 스팟 요청은 "open", "active", 또는 "disabled" 상태여야만 취소할 수 있습니다.
  - 스팟 요청을 취소한 후, 관련된 스팟 인스턴스를 종료해야 합니다. 이는 스팟 요청을 취소하면 자동으로 이루어지지 않으므로 별도로 진행해야 합니다.
- 스팟 플릿
  - 스팟 플릿(Spot Fleets)은 스팟 인스턴스와 (옵션으로) 온디맨드 인스턴스의 집합입니다.
  - 스팟 플릿은 가격 제약 조건을 충족하면서 대상 용량을 충족하려고 합니다.
    - 가능한 런치 풀(Instance Type, 운영 체제, 가용 영역)을 정의할 수 있습니다.
    - 여러 개의 시작 풀을 가질 수 있으므로 플릿은 선택할 수 있습니다.
    - 스팟 플릿은 용량이나 최대 비용에 도달할 때 인스턴스 시작을 중단합니다.
  - 스팟 인스턴스 할당을 위한 전략
    - lowestPrice: 가장 낮은 가격의 풀에서 시작 (비용 최적화, 단기 작업)
    - diversified: 모든 풀에 분산하여 시작 (가용성 향상, 장기 작업)
    - capacityOptimized: 인스턴스 수에 대한 최적 용량을 갖는 풀
  - 스팟 플릿을 사용하면 자동으로 가장 낮은 가격의 스팟 인스턴스를 요청할 수 있습니다.
- 프라이빗 vs 퍼블릭 vs 탄력적 IP
  - 프라이빗 IP와 퍼블릭 IP(IPv4)
    - 네트워킹에는 IPv4와 IPv6라는 두 가지 종류의 IP
      - IPv4: 1.160.10.240
      - IPv6: 3ffe:1900:4545:3:200:f8ff:fe21:67cf
    - IPv4는 여전히 온라인에서 가장 일반적으로 사용되는 형식입니다.
    - IPv6은 더 최근에 등장하고 사물 인터넷(IoT)을 위한 문제를 해결합니다.
    - IPv4 형식: [0-255].[0-255].[0-255].[0-255].
    - 퍼블릭 IP
      - 퍼블릭 IP는 기기가 인터넷(WWW)에서 식별될 수 있다는 것을 의미합니다.
      - 전체 웹에서 고유해야 합니다. (두 기기가 동일한 퍼블릭 IP를 가질 수 없음).
      - 지리적 위치를 쉽게 파악할 수 있습니다.
    - 프라이빗 IP
      - 프라이빗 IP는 기기가 개인 네트워크에서만 식별될 수 있다는 것을 의미합니다.
      - 프라이빗 네트워크 내에서 IP는 고유해야 합니다.
      - 그러나 두 개의 다른 프라이빗 네트워크 (두 회사)는 동일한 IP를 가질 수 있습니다.
      - 기기는 NAT + 인터넷 게이트웨이 (프록시)를 사용하여 WWW에 연결됩니다.
      - 프라이빗 IP로 사용할 수 있는 특정 범위의 IP만 사용할 수 있습니다.
  - 탄력적 IP (Elastic IP)
    - EC2 인스턴스를 중지한 후 다시 시작하면 퍼블릭 IP가 변경될 수 있습니다.
    - 인스턴스에 고정된 퍼블릭 IP가 필요한 경우, 탄력적 IP가 필요합니다.
    - 탄력적 IP는 삭제하지 않는 한 소유하고 있는 공인 IPv4 IP입니다.
    - 한 번에 하나의 인스턴스에만 연결할 수 있습니다.
    - 탄력적 IP 주소를 사용하면 인스턴스나 소프트웨어의 장애를 빠르게 다른 인스턴스로 주소를 재매핑하여 가리킬 수 있습니다.
    - 계정당 최대 5개의 탄력적 IP만 소유할 수 있습니다. (AWS에 요청하여 증가 가능)
    - 전반적으로, 탄력적 IP 사용을 피하는 것이 좋습니다
      - 이는 종종 부적절한 아키텍처적인 결정을 반영합니다.
      - 대신 random public IP를 사용하고 해당 IP에 대해 DNS 이름을 등록하십시오.
      - 또는, 나중에 볼 것처럼 로드 밸런서를 사용하고 공인 IP를 사용하지 않습니다.
- EC2 배치 그룹
  - 때로는 EC2 인스턴스 배치 전략을 제어하고자 합니다.
  - 배치 그룹을 사용하여 해당 전략을 정의할 수 있습니다.
  - 배치 그룹을 생성할 때, 그룹에 대해 다음 중 하나의 전략을 지정합니다.
    - 클러스터(Cluster) - 단일 가용 영역 내에서 저지연 그룹으로 인스턴스를 클러스터링합니다.
      - 장점
        - 향상된 네트워킹 기능이 활성화된 경우, 인스턴스 간에 10 Gbps의 대역폭을 제공하여 뛰어난 네트워크 성능을 제공합니다. (권장 사항)
      - 단점
        - 랙이 실패할 경우, 모든 인스턴스가 동시에 실패합니다.
      - 사용 사례
        - 빅 데이터 작업을 빠르게 완료해야 하는 경우
        - 극도로 낮은 지연 시간과 높은 네트워크 처리량이 필요한 애플리케이션
    - 분산(Spread) - 인스턴스를 기반 하드웨어에 분산하여 배치합니다. (가용 영역당 그룹당 최대 7개의 인스턴스)
      - 장점
        - 가용 영역(Availability Zone)을 걸쳐 확장 가능
        - 동시에 발생하는 장애의 위험을 줄임
        - EC2 인스턴스는 서로 다른 물리적 하드웨어에 위치함
      - 단점
        - 하나의 배치 그룹 당 가용 영역별 최대 7개의 인스턴스로 제한됨
      - 사용 사례
        - 고가용성을 극대화해야 하는 애플리케이션
        - 각 인스턴스가 서로의 장애로부터 격리되어야 하는 중요한 애플리케이션
    - 파티션(Partition) - 하나의 가용 영역 내에서 다양한 파티션(서로 다른 랙 세트에 의존)에 인스턴스를 분산 배치합니다. 그룹당 수백 개의 EC2 인스턴스로 확장 가능합니다. (Hadoop, Cassandra, Kafka 등에 사용됩니다.)
      - 하나의 가용 영역(Availability Zone) 당 최대 7개의 파티션까지 지원
      - 동일한 리전 내에서 여러 가용 영역을 걸쳐 확장 가능
      - 최대 100개 이상의 EC2 인스턴스까지 사용 가능
      - 한 파티션의 인스턴스는 다른 파티션의 인스턴스와는 랙을 공유하지 않음
      - 파티션의 장애는 많은 EC2 인스턴스에 영향을 줄 수 있지만, 다른 파티션에는 영향을 주지 않음
      - EC2 인스턴스는 메타데이터로 파티션 정보에 액세스할 수 있음
      - 사용 사례: HDFS, HBase, Cassandra, Kafka
- ENI(탄력적 네트워크 인터페이스)
  - [참고 자료](https://aws.amazon.com/blogs/aws/new-elastic-network-interfaces-in-the-virtual-private-cloud/)
  - VPC에서 가상 네트워크 카드를 나타내는 논리적인 구성 요소
  - ENI(탄력적 네트워크 인터페이스)는 다음과 같은 속성을 가질 수 있습니다.
    - 기본 개인 IPv4 주소, 하나 이상의 보조 IPv4 주소
    - 개인 IPv4 당 하나의 탄력적 IP (IPv4)
    - 공용 IPv4 하나
    - 하나 이상의 보안 그룹
    - MAC 주소
  - ENI를 독립적으로 생성하고 EC2 인스턴스에 동적으로 연결하여 장애 조치를 위해 이동할 수 있습니다.
  - 특정 가용 영역(AZ)에 바인딩됩니다.
- EC2 Hibernate 모드(EC2 절전 모드) 
  - 기존 EC2
    - 인스턴스를 중지(stop), 종료(terminate)할 수 있다.
      - 중지(stop) - 디스크(EBS)의 데이터는 다음 시작 때 그대로 유지된다.
      - 종료(terminate) - 루트(root)를 포함한 모든 EBS 볼륨이 파괴되도록 설정되어 있다면 손실된다.
    - 시작할 때 다음과 같은 과정이 진행된다.
      - 첫 시작: 운영 체제가 부팅되고 EC2 사용자 데이터 스크립트가 실행된다.
      - 이후의 시작: 운영 체제가 부팅된다.
      - 그런 다음 애플리케이션이 시작되고 캐시가 초기화되며, 이는 시간이 소요될 수 있다.
  - 인스턴스의 인메모리(RAM) 상태가 보존된다.
  - 인스턴스 부팅이 훨씬 빠르다(운영 체제가 중지/다시 시작되지 않음)
  - 내부 동작: RAM 상태가 루트 EBS 볼륨에 파일로 기록된다.
  - 루트 EBS 볼륨은 암호화되어야 한다.
  - 사용 사례
    - 장기간 실행되는 처리 작업
    - RAM 상태 저장
    - 초기화에 시간이 걸리는 서비스
  - 지원되는 인스턴스 패밀리 – C3, C4, C5, I3, M3, M4, R3, R4, T2, T3 등
  - 인스턴스 RAM 크기 – 150GB 미만이어야 함
  - 인스턴스 크기 – 베어 메탈 인스턴스는 지원되지 않음
  - AMI – Amazon Linux 2, Linux AMI, Ubuntu, RHEL, CentOS 및 Windows 등
  - 루트 볼륨 – EBS여야 하며 암호화되어 있어야 하며 인스턴스 스토어가 아니어야 하며 크기가 커야 함
  - 온디맨드, 예약 및 스팟 인스턴스에 사용 가능
  - 인스턴스는 60일을 초과하여 Hibernate될 수 없음