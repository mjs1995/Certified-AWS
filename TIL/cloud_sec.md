# 클라우드 보안
- 보안이란
  - 시스템,네트워크,데이터,애플리케이션 등의 정보기술의 무결성을 유지하고 외부의 공격으로부터 보호하는 관리적, 기술적 방법
- CIA 모델
  - Confidentiality (기밀성)
    - 검증되거나 허용되지 않은 주체에게는 정보 및 데이터 미공개 원칙
    - 정보 및 데이터는 허용된 주체에게 공개될 수 있어야 함 (개인정보, 은행 계좌의 잔액, 신용카드 번호, 주민등록 번호)
    - 권한 검증 -> 데이터 공개의 순서로 진행
    - 암호화(SSL, TLS, HTTPS)
    - IAM (자격증명, MFA 인증 등)
  - Integrity (무결성)
    - 검증되거나 허용되지 않은 주체가 데이터를 변경할 수 없다는 원칙
    - 데이터와 정보의 무결성을 유지하기 위한 원칙
    - 대응 개념
      - S3의 객체 권한 - ACL / Bucket Policy / 버저닝
      - 원장(Ledger) DB - Amazon QLDB
      - S3 / CloudWatch 로그의 다중 계정 보관 
  - Availability (가용성)
    - 서비스 혹은 시스템이 정상으로 동작 가능한 상태를 유지하는 원칙
    - 외부의 공격과 침입에 대비하여 서비스 혹은 시스템을 보호하는 원칙
    - 대응 개념
      - 해킹(DDOS,XSS)의 방지
      - 보안 그룹/ NACL
      - AWS WAF / AWS Shield
      - 고가용성 / 장애내구성의 확보
      - 인시던트 매니징(AWS Config 등)
  - 위 세 가지를 중심으로 한 보안 모델 , 이 모델을 통해 다른 카테고리를 추가/ 보안하여 모델 적용 
- AA 모델
  - Authentication(인증)
    - 다양한 Factor 기반으로 자신을 증명
    - 다양한 주체에서 인증을 담당 기능
    - AWS의 대응 개념 (AWS SSO, AWS Active Directory) 등
  - Authorization(인가, 권한부여)
    - 인증된 대상에 대해서 역할을 수행하기 위한 권한을 부여하는 과정
      - 부여된 권한 밖의 행동에 대해 허용하지 않는 과정 포함
      - 상황별, 조건별로 다른 권한을 부여할 수도 있음
      - AWS의 대응 개념 (IAM 역할, IAM 정책)
  - Accounting(계정 관리)
    - 계정의 활동을 기록하고 감시할 수 있어야 한다는 원칙
    - 보안 사고 발생 시, 인지할 수 있어야 함
    - 보안 사고 발생 시, 해당 사고의 내역을 추적할 수 있어야 함
    - AWS의 대응 개념
      - Amazon CloudWatch
      - Amazon CloudTrail
- 클라우드 보안 사고 사례
  - 자격증명의 유출
    - 클라우드 인프라를 접근,관리하기 위한 자격증명의 유출
    - Git/Docker Hub의 도커 파일 등 고개된 저장소에 자격증명의 유출
  - 클라우드 환경의 데이터 유출
    - 클라우드 환경의 스토리지 보안 정책의 미비로 인한 데이터 유출
    - 인도 혼다 민감 정보 유출, Capital One 개인정보 유출 
- AWS 보안 기초
  - 방지
    - 데이터의 유출과 침입 등의 보안 사고를 방지
  - 탐지
    - 로깅, 모니터링을 통해 AWS 인프라 및 조직의 보안 상태를 파악
    - 보안 관련 히스토리 파악
  - 대처
    - 자동화된 인스턴트 응답, 복구를 통해 문제 해결 및 원인 분석
  - 해결
    - 이벤트 기반 자동화를 활용하여 실시간, 신속하게 문제 해결
    - 인프라 보호
  - 보안 관련 서비스
    - 장애 인지/ 파악(CloudWatch, Config)
    - 활동 감사(CloudTrail)
    - 데이터 암호화 및 키 관리(KMS, CloudHSM, Secrets Manager, Certification Manager)
    - 권한 관리(IAM)
    - 기타 보안 관련 서비스(Inspector, Detective, Macie, AWS WAF, Shield, GuardDuty, Security Hub 등) 
  - 규정 준수
    - AWS에서는 다양한 규정한 규정을 준수하고 있으며 각 서비스별 준수 정도가 다름
    - 규정 준수를 위해서는 규정을 준수하고 있는 서비스를 이용하는것이 중요함
    - AWS Artifact: 규정 준수와 관련된 정보를 제공하는 신뢰할 수 있는 리소스
  - AWS의 공동 책임 모델
    - AWS: 클라우드 보안을 책임
    - 고객이 할 수 있으면 고객 책임, 못하면 AWS 책임
    - 고객: 클라우드에서의 보안의 책임을 준수
    - 공유 제어 항목: 패치 관리, 구성 관리, 인지 및 교육 

# AWS와 계정관리 보안
- 클라우드 컴퓨팅
  - IT 리소스를 인터넷을 통해 온디맨드로 제공하고 사용한 만큼만 비용을 지불하는 것
  - 클라우드란 빌려 쓴다는 개념
  - 데이터 센터 운영의 장점 : 100% 원하는 대로 커스터마이징 가능
  - 클라우드 운영의 장점
    - 투자비용이 적고 바로 사용할 수 있음
    - 유연하게 사용할 수 있으며 유지보수가 필요 없음
    - 사용한 만큼만 돈을 지불할 수 있음(On Demand)
- AWS 인프라의 구성
  - 리전
    - AWS의 서비스가 제공되는 서버의 물리적 위치
    - 각 리전에는 고유의 코드가 부여되며 리전별로 가능한 서비스가 다름
    - 리전 선택 시 고려사항 : 지연 속도, 법률, 사용 가능한 AWS 서비스
  - 가용 영역(Availability Zone)
    - 리전의 하부 단위로, 하나의 리전은 2개 이상의 가용 영역으로 굿어됨
    - 반드시 물리적으로 일정 거리(몇 km 이상) 떨어져 있음

# AWS IAM으로 액세스 안전 관리하기
- IAM
  - IAM을 사용하면 AWS 서비스와 리소스에 대한 액세스를 안전하게 관리할 수 있음
  - AWS 사용자 및 그룹을 만들고 관리하며 AWS 리소스에 대한 액세스를 허용 및 거부할 수 있음
  - 주요 기능
    - AWS 어카운트 관리 및 리소스 / 사용자 / 서비스의 권한 제어
    - 사용자의 생성, 관리, 계정의 보안
    - 다른 계정과의 리소스 공유
    - Identity Federation(Facebook 로그인, 구글 로그인 등)
- AWS 사용과 인증
  - AWS 웹 콘솔
    - 웹 기반의 콘솔에 로그인하여 AWS를 사용
    - 콘솔 액세스 자격 증명을 사용하여 인증
  - 프로그래밍 액세스 방식
    - CLI
    - SDK
    - 프로그램 방식 액세스 자격 증명을 사용하여 인증 

# Amazon EC2 안전하게 사용하기
- Amazon Elastic Compute Cloud
  - Amazon EC2
    - 안전하고 크기 조정이 가능한 컴퓨팅 파워를 클라우드에서 제공하는 웹 서비스
    - 개발자가 더 쉽게 웹 규모의 클라우드 컴퓨팅 작업을 할 수 있도록 설계됨
  - Amazon EC2의 장점
    - 초 단위 온디맨드 가격 모델
    - 빠른 구축 속도와 확장성
    - 다양한 구성방법 지원
    - 여러 AWS 서비스와 연동
- EC2와 연결하는 4가지 방법
  - SSH / RDP 연결
  - EC2 인스턴스 연결
  - Systems Manager / Session Manger
  - EC2 직렬 콘솔 
- EC2 권한 부여
  - 프로그램 방식 Access 자격 증명 활용
    - IAM 사용자를 서버/프로그램 별로 생성하여 Access Key를 전달하여 CLI / SDK 사용
    - AWS CLI : 서버의 별도 파일에 자격 증명을 저장하여 인증
    - AWS SDK : 별도 파일에 자격증명을 저장하거나 런타임에 자격증명을 명시해서 인증
  - IAM 자격 증명 등록
    - IAM 사용자 생성, IAM 자격증명 발급하여 EC2에 등록
    - AWS Configure를 통해 자격 증명을 파일로 등록
    - 이 권한을 가지고 있으면 누구나 가지고 갈 수 있음
    - 보안이 강력하지 않으며, 관리가 어렵고 바꾸기 힘듦

# Amazon VPC 및 네트워크 보안 
- Virtual Private Cloud
  - VPC
    - 사용자의 AWS 계정 전용 가상 네트워크
    - 원하는 대로 사설망 구축 가능: 부여된 IP 대역을 분할하여 사용 가능
    - 리전 단위
  - VPC 활용
    - EC2, RDS, Lambda 등의 AWS의 컴퓨팅 서비스 실행
    - 다양한 서브넷 구성
    - 보안 설정(IP Block, 인터넷에 노출되지 않는 EC2 등 구성)
  - VPC 구성 요소
    - 서브넷, 인터넷 게이트웨이, NACL / 보안그룹, 라우팅 테이블, NAT Instance / NAT Gateway, Bastion Host, VPC Endpoint
  - 서브넷
    - VPC의 하위 단위
    - VPC에 할당된 IP를 더 적은 단위로 분할한 개념
    - 하나의 서브넷은 하나의 가용영역(AZ) 안에 위치
    - 별도의 설정이 없다면 동일한 서브넷 IP 끼리만 통신 가능
  - 라우팅 테이블
    - 어디로 가야 되는지 알려주는 이정표
    - 트래픽이 어디를 통해 가면 되는지가 테이블에 작성됨
  - 인터넷 게이트웨이
    - VPC가 외부의 인터넷과 통신할 수 있도록 경ㄹ로를 만들어주는 리소스
    - 기본적으로 확장성과 고가용성이 확보되어 있음
    - 무료
- NAT Gateway와 Bastion Host
  - NAT Gateway
    - Amazon VPC의 프라이빗 서브넷에 있는 인스턴스에서 인터넷에 쉽게 연결할 수 있도록 지원하는 가용성이 높은 AWS 관리형 서비스
    - Private 인스턴스가 외부의 인터넷과 통신하기 위한 통로
    - NAT Gateway / 인스턴스는 모두 서브넷 단위
  - Bastion Host
    - 외부에서 사설 네트워크에 접속할 수 있도록 경로를 확보해주는 서버
    - Private 인스턴스에 접근하기 위한 EC2 인스턴스
    - Public 서브넷에 위치해야 함 
- 보안 그룹
  - 인스턴스에 대한 Inbound 및 Outbound 트래픽을 제어하는 가상 방화벽 역할
  - VPC에서 인스턴스 시작 시, 최대 5개의 보안 그룹에 인스턴스 할당 가능
  - 기본적으로 모든 포트는 비활성화
  - 선택적으로 트래픽이 지나갈 수 있는 Port와 Source를 설정 가능
  - Deny는 불가능
  - 인스턴스 단위: 하나의 EC2 인스턴스에만 적용되고, 하나의 인스턴스에 하나 이상의 보안그룹을 설정할 수 있음
  - Stateful : Inbound로 들어온 트래픽이 별다른 Outbound 설저 없이 나갈 수 있음 
- NACL(Network Access Control List)
  - 보안 그룹처럼 방화벽 역할을 담당
  - 서브넷 단위
  - 포트 및 IP를 직접 Deny 가능: 외부 공격을 받는 상황 등 특정 IP를 블록하고 싶을 때 사용
  - 순서대로 규칙 평가(낮은 숫자부터)
  - VPC의 보안 모범 사례
    - 다양한 가용 영역에 여러 서브넷 생성 : 최대한 분산시켜 저장
    - 보안그룹으로 EC2 인스턴스 트래픽 제어
    - NACL을 활용하여 서브넷 수준 트래픽 제어
    - IAM을 활용하여 트래픽 제어
    - VPC 흐름 로그 활용

# AWS 로그 수집 및 분석하기
- AWS CloudTrail
  - AWS 계정의 거버넌스, 규정 준수, 운영 감사, 위험 감사를 지원하는 서비스
  - AWS 인프라에서 계정 활동과 관련된 작업을 기록하고 지속적으로 모니터링, 보관할 수 있음
  - AWS 보안 감사를 위한 서비스 : CCTV
  - 여러 서비스에 대해 API 이용 로그 등 제공
    - API 호출의 시간 및 결과, 에러, 사용 인증 정보 등을 기록
    - AWS CLI, 콘솔 이용, API 호출 등 모든 이벤트가 대상
    - 일부 Data API의 경우 수동으로 활성화 필요
- AWS CloudWatch
  - DevOps 엔지니어, 개발자, SRE(사이트 안정성 엔지니어) 및 IT 관리자를 위해 구축된 모니터링 및 관찰 가능 서비스(퍼포먼스 체크)
  - AWS에서 제공하는 AWS 서비스 전반에 대한 모니터링 서비스
  - 주요 서비스들에 대한 모니터링(로그, 지표 등) 제공
  - 주요 기능
    - 지표(Metric) 수집 : EC2, DynamoDB, RDS 등 시간 순서별 데이터 요소의 집합
    - 경보(Alarm) : 수집된 지표 값에 따라 알림 생성 가능
    - 로그 수집 및 관리 : Lambda, EC2, Route53, ECS 등 여러 AWS 서비스의 로그 수집
    - 대시보드 : 수집한 로그/ 지표를 기반으로 대시보드 구성
- CloudTrail vs CloudWatch
  - CloudTrail : AWS를 감사하기 위한 서비스로, 단순하게 AWS 사용 로그만 저장
  - CloudWatch : AWS를 모니터링하기 위한 서비스로, AWS의 서비스 뿐 아니라 애플리케이션의 로그 및 동작 로그 취합

# Amazon S3 보안
- S3 암호화
  - Amazon S3
    - 객체 스토리지 서비스: 파일 보관만 가능
    - 글로벌 서비스 단, 데이터는 리전에 저장
    - 무제한 용량 : 하나의 객체는 0byte 에서 5TB의 용량
    - 내구성: 99.999999999% 내구성
  - S3의 보안 설정
    - S3 모든 버킷은 새로 생성시 기본적으로 Private(비공개)
    - 보안 설정은 객체 단위와 버킷 단위로 구성
    - MFA를 활용해 객체 삭제 방지 가능
    - Versioning을 통해 파일 관리 가능
    - 액세스 로그 생성 및 전송 가능
  - S3의 객체 암호화
    - On Transit : 통신하는 도중에 암호화 지원
    - At Rest(Server Side) : S3에서 파일 저장 시 암호화 지원
    - Client Side : 클라이언트가 직접 암호화(가장 강력한 보안)
- S3 버전 관리 및 객체 잠금
  - S3 버전 관리
    - 객체의 생성, 업데이트, 삭제의 모든 단계를 저장
    - 버킷 단위로 활성화 필요(기본적으로 비활성화)
    - MFA 인증 후 삭제 기능을 통해 보안 강화 기능
    - 수명 주기 관리와 연동 가능
  - 버전 관리 유의사항
    - 중지 가능(단, 비활성화 불가능)
    - 모든 버전에 대해 비용이 발생
  - 객체 잠금의 종류
    - 보관모두(Retention Mode)
      - 일정 기간 동안 수정을 방지함
      - 규정 준수 모드 : 누구도 잠금 설정 변경, 객체 삭제 불가능
      - 거버넌스 모드 : 특별한 권한 없이 삭제 혹은 잠금 설정 변경 불가능(권한 있으면 해제 가능)
    - 법적 보존(Legal Hold)
      - Hold(특정한 신호)를 객체에 부여하고 Hold가 존재하는 한 객체 삭제, 수정 불가능
- S3 버킷 정책
  - IAM 정책(Policy)의 종류
    - identity-based policies(자격 증명 기반 정책)
      - 자격증명에 부여하는 정책(IAM 유저, 그룹, 역할)
      - 해당 자격증명이 무엇을 할 수 있는지 허용
    - Resource-based policies(리소스 기반 정책)
      - 리소스에 부여하는 정책(예: S3, SQS, VPC Endpoint 등, KMS 등)
      - 해당 리소스에 누가 무엇을 할 수 있는지 허용 가능
  - S3 버킷 정책
    - 버킷 단위로 부여되는 리소스 기반 정책으로, 해당 버킷의 데이터에 정의 가능
    - 기본적으로 모든 버킷은 Private -> 접근 불가능

# AWS의 암호화 서비스
- 암호화(Encryption)
  - 암호화 기술을 사용하는 상황 : 저장된 데이터 보호, 전송 중 데이터 보호
  - 암호화 방법 : 대칭키 암호화, 비대칭키 암호화
  - 저장된 데이터 보호
    - 데이터를 저장할 때 암호화, 필요할 때 복호화 하는 방식
    - 주로 하나의 물리적인 기기에 보안을 적용하기 위해 사용
    - 주로 키 파일 혹은 암호를 사용하여 암호화 / 복호화
  - 전송 중 데이터 보호
    - 데이터 전송 중 암호화를 적용하여 데이터가 탈취당하지 않도록 보호
    - 주로 여러 시스템 / 기기 간에 보안을 적용하기 위해 사용 
  - 대칭키 암호화
    - 하나의 키로 암호화, 복호화를 하는 알고리즘으로 연산이 매우 빠름
  - 비대칭키 암호화
    - 한 쌍의 키를 활용한 암호화
    - 하나의 암호는 암호화만 가능, 다른 하나는 복호화만 가능
    - 연산이 비교적 복잡하지만 키 전달이 쉬움
- AWS Key Manage Service
  - Key Management Service
    - 안전하게 키를 생성하고 관리해주는 서비스
    - 리전 단위로 키를 보관 -> 리전 바깥으로 키가 유출되지 않음
    - 고객 마스터키를 사용하여 다양한 키를 생성함
  - Customer Master Key(CMK)
    - 마스터키를 논리적으로 표현한 키
    - CMK를 사용해서 암호화에 실제로 사용되는 키를 생성하고 암호화
    - 동작 방식 : KMS에 키 생성 요청 -> 평문키를 사용해 암호화 -> 암호화된 내용과 암호키를 저장 -> 암호키를 KMS를 보내 평문키 확보 -> 평문키로 복호화
  - AWS CloudHSM
    - 지정된 하드웨어(공유되지 않음)
    - FIPS 140-2 레벨 3 인증(KMS는 레벨2)
    - HSM에 맞는 인터페이스 제공
- AWS Certificate Manager
  - AWS Certificate Manager(ACM)
    - AWS의 SSL / TLS 인증서를 프로비전, 관리, 배포하는 서비스 
    - Public SSL 인증서의 발급 가능(무료)
      - AWS의 서비스에서만 활용 가능(AWS의 지원 서비스 한정)
      - Amazon CloudFront, ALB, Amazon API Gateway 등 특정 서비스에서만 무료 사용
    - ACM은 리전 기반
      - AP-Northeast-2 리전의 ALB에서 ACM 발급 인증서 활용 
